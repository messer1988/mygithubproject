Установка Helm
brew install helm

Проверить версию helm
helm version

( создаем helm с названием helm.nginx-app )
helm create helm.nginx-app

( переходим в  helm helm.nginx-app )
cd helm.nginx-app

Удаляем лишние файлы из templates
rm -f templates/hpa.yaml templates/serviceaccount.yaml templates/tests/test-connection.yaml templates/httproute.yaml 2>/dev/null

Есть два варианта запуска Helm!
1) Развернуть helm не перенося в него уже ранее настроенные ресурсы

При разворачивании helm он автоматически создает ресурсы
helm.nginx-app/
  Chart.yaml
  values.yaml
  templates/
    deployment.yaml
    service.yaml
    ingress.yaml
    _helpers.tpl
    hpa.yaml
    serviceaccount.yaml
    tests/
deployment, service, ingress и др тоесть то, что мы создавали самостоятельно руками helm создаст автоматически.


2) Развернуть helm перенести в него ранее уже настроенные ресурсы kuber
Наш Deployment => с liveness/readinness/startup probes и envFrom (nginx-deployment.yaml)
Service => (ClusterIP) (nginx-service.yaml)
Ingress c TLS (nginx-ingress-tls.yaml)
ConfigMap и Secret ссылающийся на values.yaml
Шаблон envsubst внутри Deployment

Мы будем разворачивать по (2) пути


2.2 Минимальные значения (values.yaml — пример)   values.yaml — единая точка настроек
replicaCount: 2
image:
  repository: nginx
  tag: alpine
  pullPolicy: IfNotPresent

service:
  port: 80

ingress:
  enabled: true
  host: nginx.local
  tls:
    enabled: false      # true + secretName, если настраиваете HTTPS

env:
  config:
    APP_ENV: production
    WELCOME_MSG: "Hello from ConfigMap"
  secret:
    DB_USER: admin
    DB_PASS: SuperSecret123

Перед установкой Chart можно проверить конфиг шаблона
helm template ./helm.nginx-app

Установка Чарта
helm install nginx-app .
kubectl get pods,svc,ingress
